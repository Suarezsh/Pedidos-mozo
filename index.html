<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tomador de Pedidos - Puro Camarón y Más</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #212529;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-size: 0.9rem;
        }
        .main-container {
            flex: 1;
            width: 100%;
            max-width: 100%;
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .header-menu {
            width: 100%;
            background-color: #e9ecef;
            padding: 10px 0;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .table-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .table-tab {
            background-color: #007bff;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            position: relative;
        }
        .table-tab.active {
            background-color: #28a745; /* Verde para mesa activa */
            font-weight: bold;
        }
        .table-tab:not(.active):hover {
            background-color: #6c757d;
        }
        .close-tab-icon {
            position: absolute;
            top: 0;
            right: 0;
            transform: translate(50%, -50%);
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1;
            transition: background-color 0.3s ease;
        }
        .close-tab-icon:hover {
            background-color: #c82333;
        }

        h1, h2, h3 {
            color: #dc3545;
            text-align: center;
            margin-bottom: 15px;
        }
        .input-section, .order-section {
            width: 100%;
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }
        input[type="number"], input[type="text"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
            box-sizing: border-box;
        }
        button {
            background-color: #dc3545;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
            margin-right: 10px;
            box-sizing: border-box;
        }
        button:hover {
            background-color: #c82333;
        }

        .autocomplete-container {
            position: relative;
            width: 100%;
            margin-bottom: 15px;
        }
        .autocomplete-items {
            position: absolute;
            border: 1px solid #ced4da;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 150px;
            overflow-y: auto;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 0 0 4px 4px;
            font-size: 0.9rem;
        }
        .autocomplete-items div {
            padding: 8px 10px;
            cursor: pointer;
            background-color: #fff;
            border-bottom: 1px solid #e9ecef;
        }
        .autocomplete-items div:hover {
            background-color: #e9ecef;
        }
        .autocomplete-active {
            background-color: #e9ecef !important;
            color: #212529;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #dee2e6;
        }
        .order-item:last-child {
            border-bottom: none;
        }
        .item-details {
            display: flex;
            align-items: center;
            gap: 10px; /* Espacio entre cantidad y nombre */
            flex-grow: 1; /* Permite que los detalles ocupen el espacio disponible */
        }
        .item-details span:first-child { /* Cantidad */
            font-weight: bold;
            color: #28a745; /* Color para la cantidad */
            min-width: 40px; /* Ancho mínimo para alinear */
            text-align: center;
        }
        .quantity-controls {
            display: flex;
            align-items: center;
        }
        .quantity-controls button {
            background-color: #28a745;
            font-size: 0.75rem;
            padding: 4px 8px;
            margin: 0 2px;
            line-height: 1;
            border-radius: 4px; /* Añadido para que los botones de cantidad también tengan borde */
        }
        .quantity-controls button:hover {
            background-color: #218838;
        }
        .remove-item-btn {
            background-color: #dc3545;
            font-size: 0.75rem;
            padding: 4px 8px;
            margin-left: 10px; /* Espacio antes del botón de eliminar */
            border-radius: 4px; /* Añadido para que el botón de eliminar también tenga borde */
        }
        .remove-item-btn:hover {
            background-color: #c82333;
        }
        .no-orders {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px 0;
        }
        .total-section {
            margin-top: 15px;
            text-align: right;
            font-size: 1.1rem;
            font-weight: bold;
            color: #dc3545;
            padding-top: 10px;
            border-top: 1px solid #dee2e6;
        }
        .logo {
            display: block;
            margin: 0 auto 20px;
            max-width: 180px;
        }
        .flex-grow {
            flex-grow: 1;
        }
        .footer {
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            background-color: #e9ecef;
            color: #6c757d;
            font-size: 0.8rem;
        }

        /* Estilos para el modal de agregar mesa flotante */
        .floating-add-table-button {
            position: fixed;
            bottom: 20px;
            left: 20px; /* Cambiado a la izquierda */
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px; /* Tamaño del icono */
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: background-color 0.3s ease;
        }
        .floating-add-table-button:hover {
            background-color: #0056b3;
        }

        /* Modal para agregar mesa */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            display: none; /* Oculto por defecto */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1002;
            border: 1px solid #dee2e6;
            text-align: center;
            min-width: 300px;
        }
        .modal-header {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #dc3545;
        }
        .modal-body label {
            margin-bottom: 5px;
        }
        .modal-body input[type="text"] {
            margin-bottom: 15px;
        }
        .modal-footer button {
            margin: 0 5px;
        }
        .btn-primary { /* Estilo para el botón principal del modal */
            background-color: #007bff;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
    </style>
    <!-- Font Awesome CSS CDN - para los iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="header-menu">
        
        <h1>Toma de Pedidos</h1>
    </div>

    <div class="main-container">
        <div id="initialView" class="input-section">
            <h2>Bienvenido</h2>
            <p>No hay mesas abiertas. Agrega una para empezar.</p>
        </div>

        <div id="tableTabsContainer" class="table-tabs">
            <!-- Los tabs de mesas se agregarán aquí -->
        </div>

        <div id="currentOrderContainer" class="order-section" style="display: none;">
            <h2>Pedido - Mesa <span id="currentTableIdentifier"></span></h2>

            <div class="autocomplete-container">
                <label for="addItemInput">Agregar Ítem:</label>
                <input type="text" id="addItemInput" placeholder="Escriba el nombre del plato o bebida...">
                <div id="autocompleteResults" class="autocomplete-items"></div>
            </div>
            <button onclick="addItemToCurrentOrder()">Agregar</button>

            <div id="orderItemsList">
                <p class="no-orders">Aún no se han agregado ítems a esta mesa.</p>
            </div>

            <div class="total-section">
                Total: <span id="orderTotal">0.00</span>
            </div>
        </div>
    </div>
    <footer class="footer">
        Puro Camarón y Más - Sistema de Toma de Pedidos
    </footer>

    <!-- Botón flotante para agregar mesa -->
    <button class="floating-add-table-button" onclick="showAddTableModal()">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Modal para agregar mesa -->
    <div id="addTableModalOverlay" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">Agregar Nueva Mesa</div>
            <div class="modal-body">
                <label for="newTableId">Nombre de la Mesa:</label>
                <input type="text" id="newTableId" placeholder="Ej: Mesa 1, Barra 5">
            </div>
            <div class="modal-footer">
                <button onclick="addTableFromModal()" class="btn-primary">Agregar Mesa</button>
                <button onclick="hideAddTableModal()" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        const allMenuItems = [
            "Chupe de Camarón", "Sudado de Camarón", "Chicharrón de Camarón", "Reventado de Camarón",
            "Cauche de Camarón", "Moquequano de Camarón", "Ceviche de Camarón", "Tortilla de Camarón",
            "Tallarín de Camarón", "Chaufa de Camarón", "Arroz de Camarón",
            "Tallarines de Langostino", "Chicharrón de Langostino", "Chicharrón Mixto",
            "Ceviche de Langostino", "Coctel de Langostino",
            "Ceviche de Pescado", "Trucha Frita", "Pejerry Arrebozado", "Lapas Arrebozadas",
            "Chicharrón de Pescado", "Sudado de Trucha", "Chicharrón de Trucha",
            "Cevichop en Crema de Rocoto", "Ceviche de Tilapia", "Chicharrón de Tilapia",
            "Milanesa de Pollo", "Chicharrón de Pollo", "Pollo al Cilindro", "Chancho al Cilindro", "Parrillas",
            "Chicharrón de Camarón + Ceviche de Pescado", "Chicharrón de Langostino + Ceviche",
            "Chicharrón Mixto + Ceviche Mixto",
            "Chicharrón de Camarón + Arroz + Ceviche", "Chicharrón de Langostino + Arroz + Ceviche",
            "Trigo", "Cuzueña", "Gaseosas", "Limonada Simple", "Limonada Especial",
            "Naranjada", "Zumo de Naranja",
            "Pisco Sour", "Sangría", "Mojito", "Piña Colada"
        ];

        let orders = {}; // { 'mesa_id': { items: [], timestamp: '' } }
        let currentTableId = null;
        const localStorageKey = 'puroCamaronMultiTableOrders';

        const initialView = document.getElementById('initialView');
        const currentOrderContainer = document.getElementById('currentOrderContainer');
        const currentTableIdentifierSpan = document.getElementById('currentTableIdentifier');
        const addItemInput = document.getElementById('addItemInput');
        const autocompleteResults = document.getElementById('autocompleteResults');
        const orderItemsList = document.getElementById('orderItemsList');
        const orderTotalSpan = document.getElementById('orderTotal');
        const tableTabsContainer = document.getElementById('tableTabsContainer');
        const addTableModalOverlay = document.getElementById('addTableModalOverlay');
        const newTableIdInput = document.getElementById('newTableId');

        // --- Autocompletado ---
        addItemInput.addEventListener('input', function() {
            const inputText = this.value.toLowerCase();
            autocompleteResults.innerHTML = '';
            if (inputText.length < 1) return false;

            const suggestions = allMenuItems.filter(item => item.toLowerCase().includes(inputText));

            suggestions.forEach(item => {
                const div = document.createElement('div');
                div.innerHTML = `<strong>${item.substr(0, inputText.length)}</strong>${item.substr(inputText.length)}`;
                div.innerHTML += `<input type="hidden" value="${item}">`;
                div.addEventListener('click', function() {
                    addItemInput.value = this.getElementsByTagName('input')[0].value;
                    autocompleteResults.innerHTML = '';
                });
                autocompleteResults.appendChild(div);
            });
        });

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.autocomplete-container')) {
                autocompleteResults.innerHTML = '';
            }
        });

        // --- Funciones de Gestión de Mesas ---
        function addTableFromModal() {
            const tableId = newTableIdInput.value.trim();
            if (!tableId) {
                alert('Por favor, ingrese un identificador para la mesa (Ej: Mesa 1, Barra).');
                return;
            }

            if (orders.hasOwnProperty(tableId)) {
                alert(`La mesa "${tableId}" ya está abierta.`);
                switchTable(tableId);
                hideAddTableModal();
                return;
            }

            orders[tableId] = { items: [], timestamp: new Date().toISOString() };
            saveOrdersToLocalStorage();
            renderTableTabs();
            switchTable(tableId);
            newTableIdInput.value = '';
            hideAddTableModal();
        }

        function renderTableTabs() {
            tableTabsContainer.innerHTML = '';
            const tableIds = Object.keys(orders);
            tableIds.forEach(tableId => {
                const tab = document.createElement('button');
                tab.classList.add('table-tab');
                if (tableId === currentTableId) {
                    tab.classList.add('active');
                }
                tab.textContent = tableId;
                tab.onclick = () => switchTable(tableId);

                const closeTabSpan = document.createElement('span');
                closeTabSpan.textContent = 'X';
                closeTabSpan.classList.add('close-tab-icon');
                closeTabSpan.onclick = (e) => {
                    e.stopPropagation();
                    if (confirm(`¿Está seguro de que desea cerrar y borrar todos los ítems de la mesa "${tableId}"?`)) {
                        deleteCurrentTable(tableId);
                    }
                };
                tab.appendChild(closeTabSpan);
                tableTabsContainer.appendChild(tab);
            });
        }

        function switchTable(tableId) {
            if (!orders.hasOwnProperty(tableId)) {
                console.error(`La mesa "${tableId}" no existe.`);
                return;
            }

            currentTableId = tableId;
            currentTableIdentifierSpan.textContent = currentTableId;
            currentOrderContainer.style.display = 'block';
            initialView.style.display = 'none';
            addItemInput.value = '';
            autocompleteResults.innerHTML = '';
            renderOrderItems();
            renderTableTabs();
        }

        function deleteCurrentTable(tableIdToDelete) {
            const tableToDelete = tableIdToDelete || currentTableId;
            if (!tableToDelete) return;

            delete orders[tableToDelete];
            saveOrdersToLocalStorage();

            const remainingTableIds = Object.keys(orders);
            let nextTableId = null;

            if (remainingTableIds.length > 0) {
                nextTableId = remainingTableIds[remainingTableIds.length - 1];
            }

            if (tableToDelete === currentTableId) {
                currentOrderContainer.style.display = 'none';
                currentTableId = null;
                currentTableIdentifierSpan.textContent = '';
                if (remainingTableIds.length === 0) {
                    initialView.style.display = 'block';
                }
            }

            renderTableTabs();

            if (nextTableId) {
                switchTable(nextTableId);
            } else if (remainingTableIds.length === 0) {
                orderItemsList.innerHTML = '<p class="no-orders">Aún no se han agregado ítems a esta mesa.</p>';
                orderTotalSpan.textContent = '0.00';
            }
        }

        function showAddTableModal() {
            addTableModalOverlay.style.display = 'flex';
        }

        function hideAddTableModal() {
            addTableModalOverlay.style.display = 'none';
            newTableIdInput.value = '';
        }

        // --- Funciones de Pedido ---
        function addItemToCurrentOrder() {
            const itemName = addItemInput.value.trim();
            if (!itemName || !currentTableId) {
                if (!currentTableId) alert('Por favor, abra o seleccione una mesa primero.');
                else alert('Por favor, seleccione un ítem del menú para agregar.');
                return;
            }

            const tableOrder = orders[currentTableId];
            const existingItem = tableOrder.items.find(item => item.name === itemName);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                tableOrder.items.push({ name: itemName, quantity: 1 });
            }

            addItemInput.value = '';
            autocompleteResults.innerHTML = '';
            renderOrderItems();
            saveOrdersToLocalStorage();
        }

        function updateQuantity(itemName, change) {
            if (!currentTableId) return;
            const tableOrder = orders[currentTableId];
            const item = tableOrder.items.find(item => item.name === itemName);

            if (item) {
                let newQuantity = item.quantity + change;
                if (newQuantity <= 0) { // Mínimo es 1, así que si intentan bajar a 0 o menos, se elimina.
                    removeItemFromCurrentOrder(itemName);
                } else {
                    item.quantity = newQuantity;
                    renderOrderItems();
                    saveOrdersToLocalStorage();
                }
            }
        }

        function removeItemFromCurrentOrder(itemName) {
            if (!currentTableId) return;
            const tableOrder = orders[currentTableId];
            tableOrder.items = tableOrder.items.filter(item => item.name !== itemName);
            renderOrderItems();
            saveOrdersToLocalStorage();
        }

        function renderOrderItems() {
            orderItemsList.innerHTML = '';
            let total = 0;

            if (!currentTableId || !orders[currentTableId] || orders[currentTableId].items.length === 0) {
                orderItemsList.innerHTML = '<p class="no-orders">Aún no se han agregado ítems a esta mesa.</p>';
            } else {
                const currentItems = orders[currentTableId].items;
                currentItems.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.classList.add('order-item');

                    const itemDetails = document.createElement('div');
                    itemDetails.classList.add('item-details');
                    // Cantidad antes del nombre
                    itemDetails.innerHTML = `<span>${item.quantity}</span><span>${item.name}</span>`;

                    const quantityControls = document.createElement('div');
                    quantityControls.classList.add('quantity-controls');
                    // Validamos que la cantidad no baje de 1
                    quantityControls.innerHTML = `
                        <button onclick="updateQuantity('${item.name}', -1)" ${item.quantity <= 1 ? 'disabled' : ''}>-</button>
                        <button onclick="updateQuantity('${item.name}', 1)">+</button>
                    `;

                    const removeButton = document.createElement('button');
                    removeButton.innerHTML = '<i class="fas fa-trash-alt"></i>'; // Icono de eliminar
                    removeButton.classList.add('remove-item-btn');
                    removeButton.onclick = () => removeItemFromCurrentOrder(item.name);

                    itemDiv.appendChild(itemDetails);
                    itemDiv.appendChild(quantityControls);
                    itemDiv.appendChild(removeButton); // Añadimos el botón con el icono
                    orderItemsList.appendChild(itemDiv);

                    total += item.quantity;
                });
            }
            orderTotalSpan.textContent = total.toFixed(2);
        }

        function saveOrdersToLocalStorage() {
            localStorage.setItem(localStorageKey, JSON.stringify(orders));
        }

        function loadOrdersFromLocalStorage() {
            const storedOrders = localStorage.getItem(localStorageKey);
            if (storedOrders) {
                orders = JSON.parse(storedOrders);
                const tableIds = Object.keys(orders);
                if (tableIds.length > 0) {
                    const lastTableId = tableIds[tableIds.length - 1];
                    switchTable(lastTableId);
                } else {
                    initialView.style.display = 'block';
                    currentOrderContainer.style.display = 'none';
                }
            } else {
                initialView.style.display = 'block';
                currentOrderContainer.style.display = 'none';
            }
            renderTableTabs();
        }

        // --- Inicialización ---
        window.onload = () => {
            loadOrdersFromLocalStorage();
        };
    </script>

</body>
</html>
